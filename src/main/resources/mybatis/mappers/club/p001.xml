<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="club.p001">
	<resultMap id="p001_d001Result01" type="clubVO">
		<result property="c_id" column="c_id" />
		<result property="c_name" column="c_name" />
		<result property="c_content" column="c_content" />
		<result property="c_category" column="c_category" />
		<result property="c_membercnt" column="c_membercnt" />
		<result property="c_hashtag" column="c_hashtag" />
		<result property="c_openingdate" column="c_openingdate" />
		<result property="c_membermax" column="c_membermax" />
		<result property="gc_name" column="gc_name"/>
		<result property="c_imgByte" column="c_img" javaType="[B" jdbcType="BLOB" />
	</resultMap>
	<resultMap id="p001_d001Result02" type="clubVO">
		<result property="c_id" column="c_id" />
		<result property="c_name" column="c_name" />
		<result property="c_content" column="c_content" />
		<result property="c_category" column="c_category" />
		<result property="c_membercnt" column="c_membercnt" />
		<result property="c_hashtag" column="c_hashtag" />
		<result property="c_openingdate" column="c_openingdate" />
		<result property="c_membermax" column="c_membermax" />
		<result property="c_ask" column="c_ask" />
		<result property="c_imgByte" column="c_img" javaType="[B" jdbcType="BLOB" />
		<collection property="articleList" column="c_id" javaType="java.util.ArrayList"
					select="getArticleList" ofType="clubArticleVO" />
	</resultMap>
	
	<resultMap id="member" type="clubMemberVO">
		<result property="m_id" column="m_id"/>
		<result property="cm_rank" column="cm_rank"/>
		<result property="userImg" column="m_img"/>
		<result property="m_nickname" column="m_nickname"/>
		<result property="m_joindate" column="m_joindate"/>
	</resultMap>
	
	<resultMap id="articleList" type="clubArticleVO">
		<result property="ca_content" column="ca_content" />
		<result property="ca_date" column="ca_date" />
		<result property="m_nickname" column="m_nickname" />
		<result property="ca_id" column="ca_id" />
		<result property="userImg" column="m_img" javaType="[B" jdbcType="BLOB"/>
		<collection property="articleImgList" column="ca_id" javaType="java.util.ArrayList"
					select="getArticleListImg" ofType="byte[]"/>
	</resultMap>
	
	<resultMap id="imgList" type="clubArticleImgVO">
		<collection property="articleImg" column="ca_img" javaType="[B" jdbcType="BLOB"/>
	</resultMap>
	
	<select id="clubList" resultMap="p001_d001Result01">
      <![CDATA[
        SELECT b.c_name,b.c_content,b.c_membercnt,b.c_id,b.c_img,
         (select c.gc_name
       	from club a, common_code c
       	where a.c_category= c.gc_id
       	and c.g_id = '019'
       	and b.c_id = a.c_id) as c_category
         from 
         (select *
         from club
         order by c_membercnt desc) b
         where rownum between 1 and 6
          ]]>
	</select>
	<select id="myClubList" resultMap="p001_d001Result01">
		<![CDATA[
		 SELECT a.c_name,a.c_membercnt,a.c_id,a.c_img
         from club a, c_member b
         where a.c_id = b.c_id
         and m_id=#{m_id}
         and cm_rank in (10,20,30)
		]]>
	</select>
	
	<select id="categoryClubList" resultMap="p001_d001Result01">
		SELECT c_name,c_content,c_membercnt,c_id,c_img,(select c.gc_name
       	from club a, common_code c
       	where a.c_category= c.gc_id
       	and c.g_id = '019'
       	and b.c_id = a.c_id) as c_category
		FROM club b
		WHERE c_category = #{c_category}
	</select>
	<select id = "memberCheck" resultMap="member">
		<![CDATA[
			select m_id,cm_rank
			from c_member
			where c_id = #{c_id}
			and m_id = #{m_id}
		]]>
	</select>
	
	<select id="categoryName" resultType="string">
		SELECT gc_name as c_category
		FROM common_code
		WHERE g_id ='019'
		AND gc_id =#{c_category}
	</select>
	<select id="searchClubList" resultMap="p001_d001Result01">
		<![CDATA[
		 select c_name,c_content,replace(c_hashtag,',','#') as c_hashtag,c_membercnt,gc_name as c_category,c_id,c_img
        from
        (
            select *
            from common_code a inner join club b on a.gc_id = b.c_category
            where g_id=019
        )
        where
        gc_name like #{searchWord}
        or c_content like #{searchWord}
        or c_name like #{searchWord}
        or c_hashtag like #{searchWord}
		]]>
	</select>

	<select id="detailClub" resultMap="p001_d001Result02">
		<![CDATA[
		 	select c_name,c_content,replace(c_hashtag,',','#') as c_hashtag,c_membercnt,gc_name as c_category,c_id,c_openingdate,c_membermax,c_img,c_ask
        from
        (
            select *
            from common_code a inner join club b on a.gc_id = b.c_category
            where g_id=019
        )
        where c_id = #{c_id}
		]]>
	</select>

	<select id="getArticleList" resultMap="club.p001.articleList">
		<![CDATA[
		 	select a.ca_content,a.ca_date,b.m_nickname,a.ca_img,a.ca_id,a.ca_pin,b.m_img,a.m_id
		 	from c_article a, member b
		 	where a.m_id = b.m_id 
		 	and a.c_id = #{c_id}
            order by a.ca_pin desc, a.ca_date desc
		]]>
	</select>
	<select id="getArticleListImg" resultMap="club.p001.imgList">
		<![CDATA[
		 	select ca_img
		 	from ca_image
		 	where ca_id = #{c_id}
		]]>
	</select>
	
	<select id="getLeaderMember" resultMap="member">
		<![CDATA[
		 	select a.m_img
			from member a, c_member b
			where a.m_id = b.m_id
			and cm_rank = 10
			and c_id = #{c_id}
		]]>
	</select>
	
	<select id="getClubMember" resultMap="member">
		<![CDATA[
		 	select a.m_img
			from member a, c_member b
			where a.m_id = b.m_id
			and cm_rank in (20,30)
			and c_id = #{c_id}
		]]>
	</select>
	
</mapper>