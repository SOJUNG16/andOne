<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="club.p003">
	<resultMap id="article" type="clubArticleVO">
		<result property="ca_content" column="ca_content"/>
		<result property="imgList" column="ca_img" javaType="[B"  jdbcType="BLOB"/>
	</resultMap>
		
	<delete id="deleteClubArticle">
		<![CDATA[
			delete from c_article
			where ca_id = #{ca_id}
		]]>
	</delete>
	
	<insert id="insertClubArticle" parameterType="java.util.Map">
		INSERT INTO c_article(ca_id,ca_content,c_id,ca_date,m_id,ca_pin)
		values(art_SEQ.NEXTVAL,#{ca_content},#{c_id},to_char(sysdate,'YYYY-MM-DD hh:mm'),#{m_id},0)
	</insert>
	
	<insert id="insertClubArticleImg" parameterType="java.util.Map">
			INSERT INTO ca_image(cai_id,ca_img,ca_id)
			values(LPAD(c_articleImg_SEQ.NEXTVAL,6,'0'),#{ca_img},art_SEQ.CURRVAL)
	</insert>
	
	<select id="editArticleView" resultMap="article">
		<![CDATA[
			select ca_content,ca_img
			from c_article
			where ca_id = #{ca_id}
		]]>
	</select>
	
	<insert id="joinClubMember" parameterType="java.util.Map">
		INSERT INTO c_member(c_id,cm_intro,m_id,cm_joindate,cm_rank)
		values(#{c_id},#{cm_intro},#{m_id},to_char(sysdate,'YYYY-MM-DD hh:mm:ss'),40)
	</insert>
	
	<delete id="leaveClub">
		{call
           declare
           begin
              	DELETE from c_member
				WHERE c_id = #{c_id}
				AND m_id = #{m_id};
               	UPDATE club
               	SET c_membercnt = c_membercnt -1
               	WHERE c_id =#{c_id};
           end
       }
	</delete>
	
	<insert id="reportClub" parameterType="java.util.Map">
		INSERT INTO report_club(c_id,r_id,r_date,rc_type)
		VALUES(#{c_id},1,to_char(sysdate,'YYYY-MM-DD hh:mm:ss'),#{rc_type})
	</insert>
	
</mapper>