<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="and.p001">
	<resultMap id="p001_d001Result01" type="AndP001AndOneVO">
		<result property="one_type" column="one_type"  /> <!-- 구분(먹기,하기,사기)-->
		<result property="one_id" column="one_id"  /> <!--글번호-->
		<result property="one_state" column="one_state"  />  <!-- 진행상태(진행중) -->
		<result property="one_category" column="one_category" /> <!-- 카테고리(치킨/피자) -->
		<result property="one_title" column="one_title" /> <!-- 제목 -->
		<result property="one_memberMax" column="one_memberMax" /> <!-- 모집인원 -->
		<result property="one_totalPrice" column="one_totalPrice" /> <!-- 총금액 -->
		<result property="one_price" column="one_price" /> <!-- 예상금액 -->		
		<result property="one_date" column="one_date" /> <!-- 실행날짜-->
		<result property="one_time" column="one_time" /> <!-- 등록시간-->
		<result property="gc_name" column="gc_name" />
		<result property="gc_id" column="gc_id" />
	</resultMap>
	
	<!-- &분의일  최근등록된 같이먹기 -->
	<select id="selectRecentList" parameterType="String" resultType="AndP001AndOneVO">
      <![CDATA[
      	select  a.one_type, a.one_id, b.gc_name as one_state, c.gc_name as one_category, a.one_title, a.one_memberMax, 
       			a.one_totalPrice/a.one_memberMax as one_price, to_char(to_date(a.one_date),'hh:mi') as one_date,
        		to_date(a.one_time,'yyyy-mm-dd hh:mi:ss') as one_time
		from and_one a, 
       		 (select gc_name, gc_id, g_id
              from common_code 
              where g_id='017') b,
             (select gc_name, gc_id, g_id
              from common_code 
              where g_id = #{g_id} ) c
	    where a.one_state = b.gc_id
		and a.one_category = c.gc_id
		and a.one_type= #{g_id}
		order by to_number(a.one_id) desc
      ]]>
	</select>
	<!-- 카테고리 이름 번호 -->
	<select id="selectCtg" parameterType="String" resultType="AndP001AndOneVO"> 
      <![CDATA[
      select gc_name, gc_id
	  from common_code
	  where g_id= #{g_id}
	  order by to_number(gc_id)
      ]]>
	</select>
	<!-- 카테고리별 검색 -->
	<select id="selctCtgList" parameterType="String" resultType="AndP001AndOneVO">
      <![CDATA[
      	select  a.one_type, a.one_id, b.gc_name as one_state, c.gc_name as one_category, a.one_title, a.one_memberMax, 
       			a.one_totalPrice/a.one_memberMax as one_price, to_char(to_date(a.one_date),'hh:mi') as one_date,
        		to_date(a.one_time,'yyyy-mm-dd hh:mi:ss') as one_time
		from and_one a, 
       		 (select gc_name, gc_id, g_id
              from common_code 
              where g_id='017') b,
             (select gc_name, gc_id, g_id
              from common_code 
              where g_id = #{g_id}
              and gc_id= #{one_category} ) c
	    where a.one_state = b.gc_id
		and a.one_category = c.gc_id
		and a.one_type= #{g_id}
		order by to_number(a.one_id) desc
      ]]>
	</select>
	
	
	
</mapper>