<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="and.p001">
	<resultMap id="p001_d001Result01" type="AndP001AndOneVO">
		<result property="one_type" column="one_type"  /> <!-- 구분(먹기,하기,사기)-->
		<result property="one_id" column="one_id"  /> <!--글번호-->
		<result property="one_state" column="one_state"  />  <!-- 진행상태(진행중) -->
		<result property="one_category" column="one_category" /> <!-- 카테고리(치킨/피자) -->
		<result property="one_title" column="one_title" /> <!-- 제목 -->
		<result property="one_memberMax" column="one_memberMax" /> <!-- 모집인원 -->
		<result property="one_totalPrice" column="one_totalPrice" /> <!-- 총금액 -->
		<result property="one_price" column="one_price" /> <!-- 예상금액 -->		
		<result property="one_date" column="one_date" /> <!-- 실행날짜-->
		<result property="one_time" column="one_time" /> <!-- 등록시간-->
		<result property="one_hashTag" column="one_hashTag" /> 
		<result property="one_locate_lat" column="one_locate_lat" /> 
		<result property="one_locate_lng" column="one_locate_lng" /> 
		<result property="gc_name" column="gc_name" />
		<result property="gc_id" column="gc_id" />
	</resultMap>
	<!-- one_date 실행날짜 one_time 등록시간 -->
	<!-- &분의일  최근등록된 같이먹기 -->
	<select id="selectRecentList" parameterType="String" resultType="AndP001AndOneVO">
      <![CDATA[
       	select *
       	from (
		      	select  a.one_type, a.one_id, b.gc_name as one_state, c.gc_name as one_category, a.one_title, a.one_memberMax, 
		       			CASE WHEN to_char(a.one_totalPrice/a.one_memberMax) = 0 then '비용없음' ELSE to_char(trunc(a.one_totalPrice/a.one_memberMax))||'원' END as one_price,
		       			substr(a.one_date,6,11) as one_date, a.one_hashTag, a.one_locate_lat, a.one_locate_lng,
		        		to_date(a.one_time,'yyyy-mm-dd hh:mi:ss') as one_time
				from and_one a, 
		       		 (select gc_name, gc_id, g_id
		              from common_code 
		              where g_id='017') b,
		             (select gc_name, gc_id, g_id
		              from common_code 
		              where g_id = #{g_id} ) c
			    where a.one_state = b.gc_id
				and a.one_category = c.gc_id
				and a.one_type= #{g_id}
				order by a.one_id desc
		)
		where rownum <=6
		
      ]]>
	</select>
	<!-- 카테고리 이름 번호 -->
	<select id="selectCtg" parameterType="String" resultType="AndP001AndOneVO"> 
      <![CDATA[
      select gc_name, gc_id
	  from common_code
	  where g_id= #{g_id}
	  order by to_number(gc_id)
      ]]>
	</select>
	<!-- 카테고리별 검색 -->
	<select id="selectCtgList" parameterType="String" resultType="AndP001AndOneVO">
      <![CDATA[
       	select *
       	from (
		      	select  a.one_type, a.one_id, b.gc_name as one_state, c.gc_name as one_category, a.one_title, a.one_memberMax, 
		       			CASE WHEN to_char(a.one_totalPrice/a.one_memberMax) = 0 then '비용없음' ELSE to_char(trunc(a.one_totalPrice/a.one_memberMax))||'원' END as one_price,
		       			substr(a.one_date,6,11) as one_date, a.one_hashTag, a.one_locate_lat, a.one_locate_lng,
		        		to_date(a.one_time,'yyyy-mm-dd hh:mi:ss') as one_time
				from and_one a, 
		       		 (select gc_name, gc_id, g_id
		              from common_code 
		              where g_id='017') b,
		             (select gc_name, gc_id, g_id
		              from common_code 
		              where g_id = #{g_id}
		              and gc_id= #{one_category} ) c
			    where a.one_state = b.gc_id
				and a.one_category = c.gc_id
				and a.one_type= #{g_id}
				order by a.one_id desc
		)
		where rownum <=6
      ]]>
	</select>
	<!-- 전체검색  추후 지역추가해야함-->
	<select id="selectTotalSearchList" parameterType="AndP001AndOneVO" resultType="AndP001AndOneVO">
      <![CDATA[
      select *
       from (
	      	select  a.one_type, a.one_id, b.gc_name as one_state, c.gc_name as one_category, a.one_title, a.one_memberMax, 
	       			CASE WHEN to_char(a.one_totalPrice/a.one_memberMax) = 0 then '비용없음' ELSE to_char(trunc(a.one_totalPrice/a.one_memberMax))||'원' END as one_price,
	       			substr(a.one_date,6,11) as one_date, a.one_hashTag, a.one_locate_lat, a.one_locate_lng,
	        		to_date(a.one_time,'yyyy-mm-dd hh:mi:ss') as one_time
			from and_one a, 
	       		 (select gc_name, gc_id, g_id
	              from common_code 
	              where g_id='017') b,
	             (select gc_name, gc_id, g_id
	              from common_code 
	              where g_id = #{g_id} ) c       
      ]]>
	      <where>
		    a.one_state = b.gc_id
			and a.one_category = c.gc_id
			and a.one_type= #{g_id}
			and(one_category like '%' ||#{totalSearch}|| '%' or a.one_title like '%' ||#{totalSearch}|| '%' or a.one_hashTag like '%' ||#{totalSearch} || '%')
	      </where>
			order by a.one_id DESC
		)
		<![CDATA[
	  	where ROWNUM <= 6
	  	 ]]>
	</select>
	<!--회원주소 가져오기 -->
	<select id="selectMemLocate" parameterType="String" resultType="String">
		<![CDATA[
			select m_locate_lat, m_locate_lng
			from member
			where m_id = #{m_id}
		]]>
	</select>
	<!-- 글에 등록된 주소 -->
	<select id="selectAndOneLocate" parameterType="String" resultType="java.util.HashMap">
		<![CDATA[
			select  a.one_locate_lat, a.one_locate_lng
			from and_one a, 
			     (select gc_name, gc_id, g_id
			      from common_code 
			      where g_id='017') b,
			     (select gc_name, gc_id, g_id
			      from common_code 
			      where g_id =  #{g_id} ) c
			where a.one_state = b.gc_id
			and a.one_category = c.gc_id
			and a.one_type=  #{g_id} 
		]]>
	</select>
</mapper>